FROM python:3.12-slim

# Install uv via pip to avoid ghcr.io auth issues
RUN pip install uv

# Set working directory
WORKDIR /var/task

# Copy dependency files
COPY pyproject.toml .
COPY requirements.txt .

# Install dependencies using uv (faster than pip)
RUN uv pip install --system -r requirements.txt

# Install additional development dependencies
RUN uv pip install --system \
    watchdog \
    python-json-logger

# Copy source code
COPY src/ src/
COPY local_server.py .

# Expose Lambda Runtime Interface Emulator port
EXPOSE 8080

# Run local development server with hot reload
CMD ["python", "local_server.py"]
